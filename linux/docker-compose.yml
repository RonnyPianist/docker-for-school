services:
  # Portainer - Admin Interface
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped
    ports:
      - "9000:9000"
      - "8000:8000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    networks:
      - devnet

  # VS Code for Python Development
  vscode-python:
    image: codercom/code-server:latest
    container_name: vscode-python
    restart: unless-stopped
    ports:
      - "8001:8080"
    environment:
      - PASSWORD=python123
      - SUDO_PASSWORD=python123
    volumes:
      - vscode_python_data:/home/coder/project
      - vscode_python_config:/home/coder/.local/share/code-server
      - ./scripts/setup-python.sh:/tmp/setup.sh:ro
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        sudo apt-get update && \
        sudo apt-get install -y python3 python3-pip python3-venv git curl wget && \
        code-server --bind-addr 0.0.0.0:8080 --auth password /home/coder/project
    networks:
      - devnet

  # VS Code for Java Development
  vscode-java:
    image: codercom/code-server:latest
    container_name: vscode-java
    restart: unless-stopped
    ports:
      - "8002:8080"
    environment:
      - PASSWORD=java123
      - SUDO_PASSWORD=java123
    volumes:
      - vscode_java_data:/home/coder/project
      - vscode_java_config:/home/coder/.local/share/code-server
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        sudo apt-get update && \
        sudo apt-get install -y default-jdk maven gradle git curl wget && \
        code-server --bind-addr 0.0.0.0:8080 --auth password /home/coder/project
    networks:
      - devnet

  # VS Code for Web Development
  vscode-web:
    image: codercom/code-server:latest
    container_name: vscode-web
    restart: unless-stopped
    ports:
      - "8003:8080"
      - "3000:3000"
      - "5173:5173"
    environment:
      - PASSWORD=web123
      - SUDO_PASSWORD=web123
    volumes:
      - vscode_web_data:/home/coder/project
      - vscode_web_config:/home/coder/.local/share/code-server
    entrypoint: ["/bin/sh", "-c"]
    command:
      - |
        curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - && \
        sudo apt-get install -y nodejs git curl wget && \
        sudo npm install -g npm@latest && \
        code-server --bind-addr 0.0.0.0:8080 --auth password /home/coder/project
    networks:
      - devnet

networks:
  devnet:
    driver: bridge

volumes:
  portainer_data:
  vscode_python_data:
  vscode_python_config:
  vscode_java_data:
  vscode_java_config:
  vscode_web_data:
  vscode_web_config:
